<template>
  <div class="wrap">
    <van-form @submit="submitForm">
      <div class="divide">ç™»è®°ä¿¡æ¯</div>
      <van-field
        readonly
        required
        :rules="[{ required: true }]"
        clickable
        name="datetimePicker"
        :value="bookForm.applyTime"
        label="ç”³è¯·æ—¶é—´"
        placeholder="ç‚¹å‡»é€‰æ‹©ç”³è¯·æ—¶é—´"
        @click="openDate"
        :right-icon="!isDetail || isDraft ? 'arrow' : ''"
      />
      <van-field
        :readonly="isDetail && !isDraft"
        v-model="bookForm.allCount"
        type="digit"
        required
        :rules="[{ required: true }]"
        maxlength="5"
        center
        clearable
        label="å®Œæˆåœºæ¬¡"
        placeholder="è¯·è¾“å…¥å®Œæˆåœºæ¬¡"
      />
      <van-field
        readonly
        required
        :rules="[{ required: true }]"
        name="picker"
        :value="bookForm.typeText"
        label="ç”³è¯·ç±»å‹"
        placeholder="è¯·é€‰æ‹©ç±»å‹"
        @click="openType"
      />
      <van-field
        readonly
        required
        :rules="[{ required: true }]"
        name="picker"
        :value="bookForm.applyStarText"
        label="ç”³è¯·æ˜Ÿçº§"
        placeholder="è¯·é€‰æ‹©æ˜Ÿçº§"
        @click="openStar"
      />
      <van-field required name="uploader" label="æ–‡ä»¶ä¸Šä¼ ">
        <template #input>
          <van-uploader
            :class="{ hide_upload: isDetail && !isDraft }"
            :max-count="5"
            :after-read="info => afterRead(info, 'file')"
            :max-size="limitedFile * 1024 * 1024"
            @oversize="ovOverFile"
            accept=".zip,.doc,.docx,.xls,.xlsx,.txt"
            v-model="fileList"
          >
            <van-button icon="plus" type="info" size="small">ä¸Šä¼ æ–‡ä»¶</van-button>
          </van-uploader>
        </template>
      </van-field>
      <van-field
        v-model="bookForm.remark"
        :readonly="isDetail && !isDraft"
        rows="3"
        autosize
        label="å¤‡æ³¨"
        type="textarea"
        maxlength="50"
        placeholder="è¯·è¾“å…¥å¤‡æ³¨"
        show-word-limit
      />
      <van-button v-if="isPending" class="btn" round block type="info" native-type="button" @click="withdarw">
        æ’¤å›
      </van-button>
      <van-button v-if="!isDetail || isDraft" class="btn" round block type="info" native-type="submit">æäº¤</van-button>
    </van-form>

    <!-- å¼¹çª—éƒ¨åˆ† -->
    <van-calendar v-model="showBookDate" @confirm="onDateConfirm" />
    <van-popup v-model="showType" position="bottom">
      <van-picker
        title="é€‰æ‹©ç”³è¯·ç±»å‹"
        show-toolbar
        :columns="typeColumns"
        @confirm="onTypeConfirm"
        @cancel="showType = false"
      />
    </van-popup>
    </div>
</template>
<script>
import { getStarDetail, postStar, cancelStar } from '@/api/name'
import { Dict } from '@/constant'

export default {
  name: 'FormTemplate',
  components: {},
  data() {
    return {
      Dict,
	  isDetail:false,
      form: {
      },
      typeColumns: [
        { value: '0', text: 'name1' },
        { value: '1', text: 'name2' }
      ],
    }
  },
  props: {},
  created() {
    document.title = 'name'
  },
  mounted() {
    const id = this.$$router.query
    console.log('ğŸš€ >> mounted >> id:', id)
    if (id) this.setDetail(id)
  },
  beforeDestroy() {},
  computed: {
	isStatus(){
		return this.state === Dict.state
	},
	isHideName(){},
	showStatusText(){
		return getStatusValue(state,Dict,valueType)
	},
  },
  watch: {},
  methods: {
    async setDetail(id) {
      console.log('ğŸš€ >> setDetail >> id:', id)
	  this.isDetail = true
      this.$toast.loading({
        duration: 0, // è®¾ç½®ä¸º0æ—¶toastä¸ä¼šæ¶ˆå¤±
        message: 'åŠ è½½ä¸­...',
        forbidClick: true,
        loadingType: 'spinner'
      })

      try {
        const res = await getDetail({ id })
      } catch (error) {
        console.log(' error:', error)
        this.$toast.fail('è·å–æ•°æ®å¤±è´¥')
      } finally {
        this.$toast.clear()
      }
    },

    async afterRead(info, type) {
      console.log('ğŸš€ >> afterRead >> info, type:', info, type)
      this.$toast.loading({
        duration: 0, // è®¾ç½®ä¸º0æ—¶toastä¸ä¼šæ¶ˆå¤±
        message: 'æäº¤ä¸­...',
        forbidClick: true,
        loadingType: 'spinner'
      })

      try {
        const { file } = info
        let postFile = new FormData()
        postFile.append('file', file)

        const res = await postLecturerRegisterFile(postFile)
        this.$toast.success('ä¸Šä¼ æˆåŠŸ')
      } catch (error) {
        this.$toast.fail('ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•')
      } finally {
        this.$toast.clear()
      }
    },

    async submitForm() {},
    
    async withdarw() {},

  }
}
</script>

å¸®æˆ‘æŠŠä»£ç åšæˆ vscde snippet